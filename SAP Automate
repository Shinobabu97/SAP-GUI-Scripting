Option Explicit
Public SapGuiAuto, WScript, msgcol
Public objGui  As GuiApplication
Public objConn As GuiConnection
Public objSBar As GuiStatusbar
Public session As GuiSession

Sub SAP_Automate()

Set SapGuiAuto = GetObject("SAPGUI")
Set objGui = SapGuiAuto.GetScriptingEngine
Set objConn = objGui.Children(0)
Set session = objConn.Children(0)
Dim nettowert As String
Dim ws As Object

Set ws = ThisWorkbook.Sheets("Tabelle1")
Set objSBar = session.FindById("wnd[0]/sbar")

session.FindById("wnd[0]").Maximize
session.FindById("wnd[0]/usr/cntlIMAGE_CONTAINER/shellcont/shell/shellcont[0]/shell").DoubleClickNode "F00002"
session.FindById("wnd[0]/usr/radP_INEX").Select
session.FindById("wnd[0]/usr/chkP_KEINWA").Selected = False
session.FindById("wnd[0]/usr/ctxtS_VBELN-LOW").Text = "8103805985"
session.FindById("wnd[0]/usr/chkP_KEINWA").SetFocus
session.FindById("wnd[0]/tbar[1]/btn[8]").Press
session.FindById("wnd[0]/usr/lbl[19,1]").SetFocus
session.FindById("wnd[0]/usr/lbl[19,1]").CaretPosition = 1
session.FindById("wnd[0]").SendVKey 2
session.FindById("wnd[0]/usr/cntlGRID1/shellcont/shell").SetCurrentCell 2, "VBELN"
session.FindById("wnd[0]/usr/cntlGRID1/shellcont/shell").DoubleClickCurrentCell
session.FindById("wnd[0]/tbar[1]/btn[7]").Press
session.FindById("wnd[0]/usr/shell/shellcont[1]/shell[1]").SelectItem "          1", "&Hierarchy"
session.FindById("wnd[0]/usr/shell/shellcont[1]/shell[1]").EnsureVisibleHorizontalItem "          1", "&Hierarchy"
session.FindById("wnd[0]/tbar[1]/btn[8]").Press
If objSBar.Text = "" Then
session.FindById("wnd[0]/usr/subSUBSCREEN_HEADER:SAPMV45A:4021/txtRV45A-ZZORDVAL").SetFocus
nettowert = session.FindById("wnd[0]/usr/subSUBSCREEN_HEADER:SAPMV45A:4021/txtRV45A-ZZORDVAL").Text
ws.Range("A1").Value = nettowert
Else
session.FindById("wnd[1]/tbar[0]/btn[0]").Press
session.FindById("wnd[0]/usr/subSUBSCREEN_HEADER:SAPMV45A:4021/txtRV45A-ZZORDVAL").SetFocus
nettowert = session.FindById("wnd[0]/usr/subSUBSCREEN_HEADER:SAPMV45A:4021/txtRV45A-ZZORDVAL").Text
ws.Range("A1").Value = nettowert
End If


End Sub
